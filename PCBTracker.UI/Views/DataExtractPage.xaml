<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:vm="clr-namespace:PCBTracker.UI.ViewModels"
  xmlns:dto="clr-namespace:PCBTracker.Domain.DTOs;assembly=PCBTracker.Domain"
  xmlns:sys="clr-namespace:System;assembly=netstandard"
  x:Class="PCBTracker.UI.Views.DataExtractPage"
  x:DataType="vm:DataExtractViewModel"
  Title="Extract Boards">

	<VerticalStackLayout Padding="10" Spacing="8">
		<HorizontalStackLayout Spacing="6">
			<Entry Placeholder="Serial #" Text="{Binding SerialNumberFilter}" WidthRequest="120"/>
			<Picker Title="Type" ItemsSource="{Binding BoardTypes}"
					SelectedItem="{Binding SelectedBoardTypeFilter}" WidthRequest="120"/>
			<DatePicker Date="{Binding PrepDateFrom}" />
			<DatePicker Date="{Binding PrepDateTo}" />
			<!-- these two now fall back to Today when your VM has null -->
			<DatePicker
			  Date="{Binding ShipDateFrom,
               TargetNullValue={x:Static sys:DateTime.Today}}" />
			<DatePicker
			  Date="{Binding ShipDateTo,
               TargetNullValue={x:Static sys:DateTime.Today}}" />
			<Button Text="Search" Command="{Binding SearchCommand}" />
			<Button Text="Export CSV" Command="{Binding ExportCsvCommand}" />
		</HorizontalStackLayout>

        <!-- Results -->
		<CollectionView ItemsSource="{Binding Boards}" SelectionMode="None">
			<CollectionView.ItemTemplate>
				<DataTemplate x:DataType="dto:BoardDto">
					<Grid ColumnDefinitions="2*,2*,*,*,*,*">
						<Label Text="{Binding SerialNumber}" Grid.Column="0"/>
						<Label Text="{Binding PartNumber}"   Grid.Column="1"/>
						<Label Text="{Binding BoardType}"    Grid.Column="2"/>
						<Label Text="{Binding PrepDate, StringFormat='d'}" Grid.Column="3"/>
						<Label Text="{Binding ShipDate, StringFormat='d'}" Grid.Column="4"/>
						<Label Text="{Binding IsShipped}"     Grid.Column="5"/>
					</Grid>
				</DataTemplate>
			</CollectionView.ItemTemplate>
		</CollectionView>

	</VerticalStackLayout>
</ContentPage>
